kind: remote
metadata:
  name: read-stocks
  tag: ''
  hash: d6ca76dfcb961e8c5e6a2c0f4c2fbc76920fce96
  project: default
spec:
  command: ''
  args: []
  image: ''
  entry_points:
    read_stocks:
      name: read_stocks
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: periods
        default: 5m
      outputs:
      - default: ''
      lineno: 12
    init_context:
      name: init_context
      doc: ''
      parameters:
      - name: context
        default: ''
      outputs:
      - default: ''
      lineno: 46
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: event
        default: ''
      outputs:
      - default: ''
      lineno: 70
  description: ''
  min_replicas: 1
  max_replicas: 4
  env: []
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from 27-09-2020 by iguazio
      labels: {}
      name: read-stocks
    spec:
      build:
        baseImage: python:3.6-jessie
        commands:
        - pip install lxml
        - pip install yfinance
        - pip install requests
        - pip install v3io_frames
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB5ZmluYW5jZSBhcyB5ZgppbXBvcnQgb3MKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHYzaW9fZnJhbWVzIGFzIHYzZgppbXBvcnQgYXN0CgpkZWYgcmVhZF9zdG9ja3MoY29udGV4dCwgcGVyaW9kcz0nNW0nKToKICAgIHN0b2Nrcz1bXTsgdGltZXM9W107IHZvbHVtZXM9W107IHByaWNlcz1bXQogICAgCiAgICBmb3Igc3ltIGluIGNvbnRleHQuc3RvY2tfc3ltczoKICAgICAgICBoaXN0ID0geWYuVGlja2VyKHN5bSkuaGlzdG9yeShwZXJpb2Q9cGVyaW9kcywgaW50ZXJ2YWw9JzFtJykKICAgICAgICB0aW1lID0gaGlzdC5pbmRleFtsZW4oaGlzdCkgLSAxXQogICAgICAgIHJlY29yZCA9IGhpc3QubG9jW3RpbWVdCiAgICAgICAgbGFzdCA9IGNvbnRleHQubGFzdF90cmFkZV90aW1lcy5nZXQoc3ltKQogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidSZWNlaXZlZCB7c3ltfSBkYXRhIGZyb20geWZpbmFuY2UsIGluY2x1ZGluZyB7bGVuKGhpc3QpfSBjYW5kbGVzIGVuZGluZyBhdCB7bGFzdH0nKQoKICAgICAgICAKICAgICAgICBpZiBub3QgbGFzdCBvciB0aW1lID4gbGFzdDoKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGxhc3QgaXMgbm90IE5vbmU6CiAgICAgICAgICAgICAgICBoaXN0ID0gaGlzdFtoaXN0LmluZGV4ID4gbGFzdF0KICAgICAgICAgICAgCiAgICAgICAgICAgIHN0b2NrID0geydzeW1ib2wnOiBzeW0sICdwcmljZSc6IHJlY29yZFsnQ2xvc2UnXSwgJ3ZvbHVtZSc6IHJlY29yZFsnVm9sdW1lJ10sICdsYXN0X3VwZGF0ZWQnOiB0aW1lfQogICAgICAgICAgICBleHByID0gY29udGV4dC5leHByX3RlbXBsYXRlLmZvcm1hdCgqKnN0b2NrKQogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5kZWJ1Z193aXRoKCd1cGRhdGUgZXhwcmVzc2lvbicsIHN5bWJvbD1zeW0sIGV4cHI9ZXhwcikKICAgICAgICAgICAgY29udGV4dC52M2MuZXhlY3V0ZSgna3YnLCBjb250ZXh0LnN0b2Nrc19rdl90YWJsZSwgJ3VwZGF0ZScsIGFyZ3M9eydrZXknOiBzeW0sICdleHByZXNzaW9uJzogZXhwcn0pCiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidVcGRhdGVkIHJlY29yZHMgZnJvbSB7bGFzdH0gdG8ge3RpbWV9JykKICAgICAgICAgICAgY29udGV4dC5sYXN0X3RyYWRlX3RpbWVzW3N5bV0gPSB0aW1lIAogICAgICAgICAgICAKICAgICAgICAgICAgZGYgPSBoaXN0W1snQ2xvc2UnLCAnVm9sdW1lJ11dLmNvcHkoKQogICAgICAgICAgICBkZi5yZW5hbWUoY29sdW1ucz17J0Nsb3NlJzogJ3ByaWNlJywgJ1ZvbHVtZSc6ICd2b2x1bWUnfSwgaW5wbGFjZT1UcnVlKQogICAgICAgICAgICBkZlsnc3ltYm9sJ10gPSBzeW0KICAgICAgICAgICAgZGYuc2V0X2luZGV4KFsnc3ltYm9sJ10sIGFwcGVuZD1UcnVlLCBpbnBsYWNlPVRydWUpCiAgICAgICAgICAgIGNvbnRleHQudjNjLndyaXRlKGJhY2tlbmQ9J3RzZGInLCB0YWJsZT1jb250ZXh0LnN0b2Nrc190c2RiX3RhYmxlLCBkZnM9ZGYpCiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidVcGRhdGVkIFRTREIge2xlbihkZil9IHJlY29yZHMnKQoKICAgICAgICBlbHNlOgogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYnTm8gdXBkYXRlIHdhcyBtYWRlLCBjdXJyZW50IFRTOiB7bGFzdH0gdnMuIG5ldyBkYXRhIHt0aW1lfScpCiAgICAgICAgICAgICAgIAoKZGVmIGluaXRfY29udGV4dChjb250ZXh0KToKICAgIGNsaWVudCA9IHYzZi5DbGllbnQoJ2ZyYW1lc2Q6ODA4MScsY29udGFpbmVyPW9zLmdldGVudignVjNJT19DT05UQUlORVInLCAnYmlnZGF0YScpKQogICAgc2V0YXR0cihjb250ZXh0LCAndjNjJywgY2xpZW50KQogICAgCiAgICBzZXRhdHRyKGNvbnRleHQsICdzdG9ja3Nfa3ZfdGFibGUnLCBvcy5nZXRlbnYoJ1NUT0NLU19LVl9UQUJMRScsICdzdG9ja3Mvc3RvY2tzX2t2JykpCiAgICBzZXRhdHRyKGNvbnRleHQsICdzdG9ja3NfdHNkYl90YWJsZScsIG9zLmdldGVudignU1RPQ0tTX1RTREJfVEFCTEUnLCAnc3RvY2tzL3N0b2Nrc190c2RiJykpCiAgICBjb250ZXh0LnYzYy5jcmVhdGUoYmFja2VuZD0ndHNkYicsIHRhYmxlPWNvbnRleHQuc3RvY2tzX3RzZGJfdGFibGUsIHJhdGU9JzEvbScsIGlmX2V4aXN0cz0xKQogICAgCiAgICBzdG9ja3MgPSBvcy5nZXRlbnYoJ1NUT0NLX0xJU1QnLCdHT09HLE1TRlQsQU1aTixBQVBMLElOVEMnKQogICAgaWYgc3RvY2tzLnN0YXJ0c3dpdGgoJ1snKToKICAgICAgICBzdG9ja19zeW1zID0gYXN0LmxpdGVyYWxfZXZhbChzdG9ja3MpCiAgICBlbHNlOiAKICAgICAgICBzdG9ja19zeW1zID0gc3RvY2tzLnNwbGl0KCcsJykKICAgIHNldGF0dHIoY29udGV4dCwgJ3N0b2NrX3N5bXMnLCBzdG9ja19zeW1zKQogICAgCgogICAgZXhwcl90ZW1wbGF0ZSA9IG9zLmdldGVudignRVhQUkVTU0lPTl9URU1QTEFURScsICJzeW1ib2w9J3tzeW1ib2x9JztwcmljZT17cHJpY2V9O3ZvbHVtZT17dm9sdW1lfTtsYXN0X3VwZGF0ZWQ9J3tsYXN0X3VwZGF0ZWR9JyIpCiAgICBzZXRhdHRyKGNvbnRleHQsICdleHByX3RlbXBsYXRlJywgZXhwcl90ZW1wbGF0ZSkKCiAgICBsYXN0X3RyYWRlX3RpbWVzID0ge30KICAgIHNldGF0dHIoY29udGV4dCwgJ2xhc3RfdHJhZGVfdGltZXMnLCBsYXN0X3RyYWRlX3RpbWVzKQogICAgCiAgICByZWFkX3N0b2Nrcyhjb250ZXh0LCAnN2QnKQoKZGVmIGhhbmRsZXIoY29udGV4dCwgZXZlbnQpOgogICAgCiAgICByZWFkX3N0b2Nrcyhjb250ZXh0KQogICAgcmV0dXJuICdkb25lJwoK
        noBaseImagesPull: true
      env:
      - name: V3IO_ACCESS_KEY
        value: 7674035f-0ffb-46ac-924e-de058e82c3e8
      - name: V3IO_USERNAME
        value: iguazio
      - name: V3IO_API
        value: v3io-webapi.default-tenant.svc:8081
      handler: 03-read-stocks:handler
      runtime: python:3.6
      triggers:
        secs:
          attributes:
            interval: 300s
          kind: cron
      volumes: []
  source: ''
