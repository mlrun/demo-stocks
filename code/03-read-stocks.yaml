kind: remote
metadata:
  name: read-stocks
  tag: ''
  hash: 891429737b7ebf699ad3480f0261a717125366d7
  project: default
spec:
  command: ''
  args: []
  image: ''
  entry_points:
    init_context:
      name: init_context
      doc: ''
      parameters:
      - name: context
        default: ''
      outputs:
      - default: ''
      lineno: 12
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: event
        default: ''
      outputs:
      - default: ''
      lineno: 34
  description: ''
  min_replicas: 1
  max_replicas: 4
  env: []
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from 15-09-2020 by admin
      labels: {}
      name: read-stocks
    spec:
      build:
        baseImage: python:3.6-jessie
        commands:
        - pip install lxml
        - pip install yfinance
        - pip install requests
        - pip install v3io_frames
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB5ZmluYW5jZSBhcyB5ZgppbXBvcnQgb3MKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHYzaW9fZnJhbWVzIGFzIHYzZgppbXBvcnQgYXN0CgpkZWYgaW5pdF9jb250ZXh0KGNvbnRleHQpOgogICAgY2xpZW50ID0gdjNmLkNsaWVudCgnZnJhbWVzZDo4MDgxJyxjb250YWluZXI9b3MuZ2V0ZW52KCdWM0lPX0NPTlRBSU5FUicsICdiaWdkYXRhJykpCiAgICBzZXRhdHRyKGNvbnRleHQsICd2M2MnLCBjbGllbnQpCiAgICAKICAgIHNldGF0dHIoY29udGV4dCwgJ3N0b2Nrc19rdl90YWJsZScsIG9zLmdldGVudignU1RPQ0tTX0tWX1RBQkxFJywgJ3N0b2Nrc19rdicpKQogICAgc2V0YXR0cihjb250ZXh0LCAnc3RvY2tzX3RzZGJfdGFibGUnLCBvcy5nZXRlbnYoJ1NUT0NLU19UU0RCX1RBQkxFJywgJ3N0b2Nrc190c2RiJykpCiAgICBjb250ZXh0LnYzYy5jcmVhdGUoYmFja2VuZD0ndHNkYicsIHRhYmxlPWNvbnRleHQuc3RvY2tzX3RzZGJfdGFibGUsIHJhdGU9JzEvbScsIGlmX2V4aXN0cz0xKQogICAgCiAgICBzdG9ja3MgPSBvcy5nZXRlbnYoJ1NUT0NLX0xJU1QnLCdHT09HLE1TRlQsQU1aTixBQVBMLElOVEMnKQogICAgaWYgc3RvY2tzLnN0YXJ0c3dpdGgoJ1snKToKICAgICAgICBzdG9ja19zeW1zID0gYXN0LmxpdGVyYWxfZXZhbChzdG9ja3MpCiAgICBlbHNlOiAKICAgICAgICBzdG9ja19zeW1zID0gc3RvY2tzLnNwbGl0KCcsJykKICAgIHNldGF0dHIoY29udGV4dCwgJ3N0b2NrX3N5bXMnLCBzdG9ja19zeW1zKQogICAgCgogICAgZXhwcl90ZW1wbGF0ZSA9IG9zLmdldGVudignRVhQUkVTU0lPTl9URU1QTEFURScsICJzeW1ib2w9J3tzeW1ib2x9JztwcmljZT17cHJpY2V9O3ZvbHVtZT17dm9sdW1lfTtsYXN0X3VwZGF0ZWQ9J3tsYXN0X3VwZGF0ZWR9JyIpCiAgICBzZXRhdHRyKGNvbnRleHQsICdleHByX3RlbXBsYXRlJywgZXhwcl90ZW1wbGF0ZSkKCiAgICBsYXN0X3RyYWRlX3RpbWVzID0ge30KICAgIHNldGF0dHIoY29udGV4dCwgJ2xhc3RfdHJhZGVfdGltZXMnLCBsYXN0X3RyYWRlX3RpbWVzKQoKZGVmIGhhbmRsZXIoY29udGV4dCwgZXZlbnQpOgogICAgCiAgICBzdG9ja3M9W107IHRpbWVzPVtdOyB2b2x1bWVzPVtdOyBwcmljZXM9W10KICAgIAogICAgZm9yIHN5bSBpbiBjb250ZXh0LnN0b2NrX3N5bXM6CiAgICAgICAgaGlzdCA9IHlmLlRpY2tlcihzeW0pLmhpc3RvcnkocGVyaW9kPSc1bScsIGludGVydmFsPScxbScpCiAgICAgICAgdGltZSA9IGhpc3QuaW5kZXhbbGVuKGhpc3QpIC0gMV0KICAgICAgICByZWNvcmQgPSBoaXN0LmxvY1t0aW1lXQogICAgICAgIGxhc3QgPSBjb250ZXh0Lmxhc3RfdHJhZGVfdGltZXMuZ2V0KHN5bSkKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYnUmVjZWl2ZWQge3N5bX0gZGF0YSBmcm9tIHlmaW5hbmNlLCBpbmNsdWRpbmcge2xlbihoaXN0KX0gY2FuZGxlcyBlbmRpbmcgYXQge2xhc3R9JykKCiAgICAgICAgCiAgICAgICAgaWYgbm90IGxhc3Qgb3IgdGltZSA+IGxhc3Q6CiAgICAgICAgICAgIAogICAgICAgICAgICBzdG9jayA9IHsnc3ltYm9sJzogc3ltLCAncHJpY2UnOiByZWNvcmRbJ0Nsb3NlJ10sICd2b2x1bWUnOiByZWNvcmRbJ1ZvbHVtZSddLCAnbGFzdF91cGRhdGVkJzogdGltZX0KICAgICAgICAgICAgZXhwciA9IGNvbnRleHQuZXhwcl90ZW1wbGF0ZS5mb3JtYXQoKipzdG9jaykKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuZGVidWdfd2l0aCgndXBkYXRlIGV4cHJlc3Npb24nLCBzeW1ib2w9c3ltLCBleHByPWV4cHIpCiAgICAgICAgICAgIGNvbnRleHQudjNjLmV4ZWN1dGUoJ2t2JywgY29udGV4dC5zdG9ja3Nfa3ZfdGFibGUsICd1cGRhdGUnLCBhcmdzPXsna2V5Jzogc3ltLCAnZXhwcmVzc2lvbic6IGV4cHJ9KQogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYnVXBkYXRlZCByZWNvcmRzIGZyb20ge2xhc3R9IHRvIHt0aW1lfScpCiAgICAgICAgICAgIGNvbnRleHQubGFzdF90cmFkZV90aW1lc1tzeW1dID0gdGltZSAKICAgICAgICAgICAgc3RvY2tzICs9IFtzeW1dCiAgICAgICAgICAgIHRpbWVzICs9W3RpbWVdCiAgICAgICAgICAgIHZvbHVtZXMgKz0gW3JlY29yZFsnVm9sdW1lJ11dCiAgICAgICAgICAgIHByaWNlcyArPSBbcmVjb3JkWydDbG9zZSddXQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidObyB1cGRhdGUgd2FzIG1hZGUsIGN1cnJlbnQgVFM6IHtsYXN0fSB2cy4gbmV3IGRhdGEge3RpbWV9JykKICAgICAgICAgICAgICAgCiAgICBpZiBsZW4oc3RvY2tzKT4wOgogICAgICAgIGRmID0gcGQuRGF0YUZyYW1lKHsndm9sdW1lJzp2b2x1bWVzLCdwcmljZSc6IHByaWNlc30sIGluZGV4PVt0aW1lcyxzdG9ja3NdLCBjb2x1bW5zPVsndm9sdW1lJywncHJpY2UnXSkKICAgICAgICBkZi5pbmRleC5uYW1lcz1bJ3RpbWUnLCdzeW1ib2wnXQogICAgICAgIGNvbnRleHQubG9nZ2VyLmRlYnVnX3dpdGgoJ3dyaXRpbmcgZGF0YSB0byBUU0RCJywgc3RvY2tzPXN0b2NrcykKICAgICAgICBjb250ZXh0LnYzYy53cml0ZShiYWNrZW5kPSd0c2RiJywgdGFibGU9Y29udGV4dC5zdG9ja3NfdHNkYl90YWJsZSwgZGZzPWRmKQogICAgICAgIAogICAgcmV0dXJuICdkb25lJwoK
        noBaseImagesPull: true
      env:
      - name: V3IO_ACCESS_KEY
        value: 4253f5c9-020f-4e6c-ae66-c9e9c5ad24ed
      - name: V3IO_USERNAME
        value: admin
      - name: V3IO_API
        value: v3io-webapi.default-tenant.svc:8081
      handler: 03-read-stocks:handler
      runtime: python:3.6
      triggers:
        secs:
          attributes:
            interval: 300s
          kind: cron
      volumes: []
  source: ''
