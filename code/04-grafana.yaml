kind: job
metadata:
  name: grafana-dashboard-deployer
  tag: ''
  hash: 43a6e9fbf508272e80cd3375b5d310b0dda7f85b
  project: stocks
spec:
  command: ''
  args: []
  env: []
  default_handler: deploy_dashboard
  entry_points:
    deploy_dashboard:
      name: deploy_dashboard
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: grafana_url
        type: str
        default: http://grafana
      - name: streamview_url
        type: str
        default: http://192.168.224.237:32058
      - name: v3io_container
        type: str
        default: bigdata
      - name: stocks_kv_table
        type: str
        default: stocks/stocks_kv
      - name: stocks_tsdb_table
        type: str
        default: stocks/stocks_tsdb
      - name: stocks_sentiment_tsdb_table
        type: str
        default: stocks/stocks_sentiment_tsdb
      outputs:
      - default: ''
      lineno: 7
  description: ''
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKZnJvbSBncmFmd2l6IGltcG9ydCAqCmltcG9ydCBvcwppbXBvcnQgdjNpb19mcmFtZXMgYXMgdjNmCgpkZWYgZGVwbG95X2Rhc2hib2FyZChjb250ZXh0LCAKICAgICAgICAgICAgICAgICAgICAgZ3JhZmFuYV91cmw6c3RyID0gJ2h0dHA6Ly9ncmFmYW5hJywgCiAgICAgICAgICAgICAgICAgICAgIHN0cmVhbXZpZXdfdXJsOnN0ciA9ICdodHRwOi8vMTkyLjE2OC4yMjQuMjM3OjMyMDU4JywKICAgICAgICAgICAgICAgICAgICAgdjNpb19jb250YWluZXI6c3RyID0gJ2JpZ2RhdGEnLAogICAgICAgICAgICAgICAgICAgICBzdG9ja3Nfa3ZfdGFibGU6c3RyID0gJ3N0b2Nrcy9zdG9ja3Nfa3YnLAogICAgICAgICAgICAgICAgICAgICBzdG9ja3NfdHNkYl90YWJsZTpzdHIgPSAnc3RvY2tzL3N0b2Nrc190c2RiJywKICAgICAgICAgICAgICAgICAgICAgc3RvY2tzX3NlbnRpbWVudF90c2RiX3RhYmxlOnN0ciA9ICdzdG9ja3Mvc3RvY2tzX3NlbnRpbWVudF90c2RiJyk6CiAgICBEYXRhU291cmNlKG5hbWU9J0lndWF6aW8nKS5kZXBsb3koZ3JhZmFuYV91cmwsIHVzZV9hdXRoPVRydWUpCiAgICBEYXRhU291cmNlKG5hbWU9J3N0cmVhbS12aWV3ZXInLCBmcmFtZXNfdXJsPXN0cmVhbXZpZXdfdXJsKS5kZXBsb3koZ3JhZmFuYV91cmwsIHVzZV9hdXRoPUZhbHNlLCBvdmVyd3JpdGU9RmFsc2UpCiAgICAKICAgIGNsaWVudCA9IHYzZi5DbGllbnQoJ2ZyYW1lc2Q6ODA4MScsIGNvbnRhaW5lcj12M2lvX2NvbnRhaW5lcikKICAgIGNsaWVudC5leGVjdXRlKGJhY2tlbmQ9J2t2JywgdGFibGU9c3RvY2tzX2t2X3RhYmxlLCBjb21tYW5kPSdpbmZlcicpCiAgICAKICAgIGRhc2ggPSBEYXNoYm9hcmQoInN0b2NrcyIsIHN0YXJ0PSdub3ctN2QnLCBkYXRhU291cmNlPSdJZ3VhemlvJykKCiAgICBkYXNoLnRlbXBsYXRlKG5hbWU9IlNZTUJPTCIsIGxhYmVsPSJTeW1ib2wiLCBxdWVyeT0iZmllbGRzPXN5bWJvbDt0YWJsZT1zdG9ja3Mvc3RvY2tzX2t2O2JhY2tlbmQ9a3Y7Y29udGFpbmVyPWJpZ2RhdGEiKQoKICAgIHRibCA9IFRhYmxlKCdDdXJyZW50IFN0b2NrcyBWYWx1ZScsc3Bhbj00KS5zb3VyY2UodGFibGU9c3RvY2tzX2t2X3RhYmxlLGZpZWxkcz1bJ3N5bWJvbCcsJ3ZvbHVtZScsICdwcmljZScsJ2xhc3RfdXBkYXRlZCddLGNvbnRhaW5lcj12M2lvX2NvbnRhaW5lcikKICAgIGxvZyA9IFRhYmxlKCdBcnRpY2xlcyBMb2cnLCBkYXRhU291cmNlPSdzdHJlYW0tdmlld2VyJywgc3Bhbj00KQogICAgZGFzaC5yb3coW3RibCxsb2ddKQoKICAgIGRhc2gucm93KFtHcmFwaChtZXRyaWMpLnNlcmllcyh0YWJsZT1zdG9ja3NfdHNkYl90YWJsZSwgZmllbGRzPVttZXRyaWNdLCBmaWx0ZXI9J3N5bWJvbD09IiRTWU1CT0wiJyxjb250YWluZXI9djNpb19jb250YWluZXIpIGZvciBtZXRyaWMgaW4gWydwcmljZScsJ3ZvbHVtZSddXSkKICAgIGRhc2gucm93KFtHcmFwaCgnc2VudGltZW50Jykuc2VyaWVzKHRhYmxlPXN0b2Nrc19zZW50aW1lbnRfdHNkYl90YWJsZSwgZmllbGRzPVsnc2VudGltZW50J10sIGZpbHRlcj0nc3ltYm9sPT0iJFNZTUJPTCInLCBjb250YWluZXI9djNpb19jb250YWluZXIpXSkKICAgIAogICAgcmV0dXJuIGRhc2guZGVwbG95KGdyYWZhbmFfdXJsKQoK
    base_image: mlrun/mlrun
    commands:
    - pip install git+https://github.com/v3io/grafwiz --upgrade
    code_origin: https://github.com/mlrun/demo-stocks#083e5cbc3da91c0a295ff719c0c2bdef7106006c:grafana_dashboard_deployer.ipynb
