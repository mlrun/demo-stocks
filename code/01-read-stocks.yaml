kind: remote
metadata:
  name: read-stocks
  tag: ''
  hash: ff493d05c87f5cb9648e99903f224b1113516d05
  project: default
spec:
  command: ''
  args: []
  image: ''
  entry_points:
    update_tickers:
      name: update_tickers
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: perdiod
        default: ''
      - name: interval
        default: ''
      outputs:
      - default: ''
      lineno: 12
    init_context:
      name: init_context
      doc: ''
      parameters:
      - name: context
        default: ''
      outputs:
      - default: ''
      lineno: 48
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: event
        default: ''
      outputs:
      - default: ''
      lineno: 72
  description: ''
  min_replicas: 1
  max_replicas: 4
  env: []
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from 27-09-2020 by admin
      labels: {}
      name: read-stocks
    spec:
      build:
        baseImage: python:3.6-jessie
        commands:
        - pip install lxml
        - pip install yfinance
        - pip install requests
        - pip install v3io_frames
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IGpzb24KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCB5ZmluYW5jZSBhcyB5ZgppbXBvcnQgb3MKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHYzaW9fZnJhbWVzIGFzIHYzZgppbXBvcnQgYXN0CgpkZWYgdXBkYXRlX3RpY2tlcnMoY29udGV4dCwgcGVyZGlvZCwgaW50ZXJ2YWwpOgogICAgc3RvY2tzPVtdOyB0aW1lcz1bXTsgdm9sdW1lcz1bXTsgcHJpY2VzPVtdCiAgICAKICAgIHN0b2Nrc19kZiA9IHBkLkRhdGFGcmFtZSgpCiAgICBmb3Igc3ltIGluIGNvbnRleHQuc3RvY2tfc3ltczoKICAgICAgICBoaXN0ID0geWYuVGlja2VyKHN5bSkuaGlzdG9yeShwZXJpb2Q9cGVyZGlvZCwgaW50ZXJ2YWw9JzFtJykKICAgICAgICB0aW1lID0gaGlzdC5pbmRleFtsZW4oaGlzdCkgLSAxXQogICAgICAgIHJlY29yZCA9IGhpc3QubG9jW3RpbWVdCiAgICAgICAgbGFzdCA9IGNvbnRleHQubGFzdF90cmFkZV90aW1lcy5nZXQoc3ltKQogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidSZWNlaXZlZCB7c3ltfSBkYXRhIGZyb20geWZpbmFuY2UsIGluY2x1ZGluZyB7bGVuKGhpc3QpfSBjYW5kbGVzIGVuZGluZyBhdCB7bGFzdH0nKQoKICAgICAgICAKICAgICAgICBpZiBub3QgbGFzdCBvciB0aW1lID4gbGFzdDoKICAgICAgICAgICAgCiAgICAgICAgICAgIHN0b2NrID0geydzeW1ib2wnOiBzeW0sICdwcmljZSc6IHJlY29yZFsnQ2xvc2UnXSwgJ3ZvbHVtZSc6IHJlY29yZFsnVm9sdW1lJ10sICdsYXN0X3VwZGF0ZWQnOiB0aW1lfQogICAgICAgICAgICBleHByID0gY29udGV4dC5leHByX3RlbXBsYXRlLmZvcm1hdCgqKnN0b2NrKQogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5kZWJ1Z193aXRoKCd1cGRhdGUgZXhwcmVzc2lvbicsIHN5bWJvbD1zeW0sIGV4cHI9ZXhwcikKICAgICAgICAgICAgY29udGV4dC52M2MuZXhlY3V0ZSgna3YnLCBjb250ZXh0LnN0b2Nrc19rdl90YWJsZSwgJ3VwZGF0ZScsIGFyZ3M9eydrZXknOiBzeW0sICdleHByZXNzaW9uJzogZXhwcn0pCiAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidVcGRhdGVkIHJlY29yZHMgZnJvbSB7bGFzdH0gdG8ge3RpbWV9JykKICAgICAgICAgICAgY29udGV4dC5sYXN0X3RyYWRlX3RpbWVzW3N5bV0gPSB0aW1lCiAgICAgICAgICAgIGhpc3RbJ3N5bWJvbCddID0gc3ltCiAgICAgICAgICAgIGhpc3QgPSBoaXN0LnJlc2V0X2luZGV4KCkKICAgICAgICAgICAgaGlzdCA9IGhpc3Quc2V0X2luZGV4KFsnRGF0ZXRpbWUnLCAnc3ltYm9sJ10pCiAgICAgICAgICAgIGhpc3QgPSBoaXN0LmxvY1s6LCBbJ0Nsb3NlJywgJ1ZvbHVtZSddXQogICAgICAgICAgICBoaXN0ID0gaGlzdC5yZW5hbWUoY29sdW1ucz17J0Nsb3NlJzogJ3ByaWNlJywgJ1ZvbHVtZSc6ICd2b2x1bWUnfSkKICAgICAgICAgICAgc3RvY2tzX2RmID0gc3RvY2tzX2RmLmFwcGVuZChoaXN0KQogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYnQWRkZWQgcmVjb3JkcyB7aGlzdC5zaGFwZVswXX0gcmVjb3JkcyBmb3Ige3N5bX0gdG8gaGlzdG9yeScpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmJ05vIHVwZGF0ZSB3YXMgbWFkZSwgY3VycmVudCBUUzoge2xhc3R9IHZzLiBuZXcgZGF0YSB7dGltZX0nKQogICAgICAgICAgICAgICAKICAgIGlmIHN0b2Nrc19kZi5zaGFwZVswXT4wOgogICAgICAgIHN0b2Nrc19kZiA9IHN0b2Nrc19kZi5zb3J0X2luZGV4KGxldmVsPTApCiAgICAgICAgY29udGV4dC5sb2dnZXIuZGVidWdfd2l0aCgnd3JpdGluZyBkYXRhIHRvIFRTREInLCBzdG9ja3M9c3RvY2tzX2RmKQogICAgICAgIHN0b2Nrc19kZi50b19jc3YoJ2hpc3RvcnkuY3N2JykKICAgICAgICBjb250ZXh0LnYzYy53cml0ZShiYWNrZW5kPSd0c2RiJywgdGFibGU9Y29udGV4dC5zdG9ja3NfdHNkYl90YWJsZSwgZGZzPXN0b2Nrc19kZikKCmRlZiBpbml0X2NvbnRleHQoY29udGV4dCk6CiAgICBjbGllbnQgPSB2M2YuQ2xpZW50KCdmcmFtZXNkOjgwODEnLGNvbnRhaW5lcj1vcy5nZXRlbnYoJ1YzSU9fQ09OVEFJTkVSJywgJ2JpZ2RhdGEnKSkKICAgIHNldGF0dHIoY29udGV4dCwgJ3YzYycsIGNsaWVudCkKICAgIAogICAgc2V0YXR0cihjb250ZXh0LCAnc3RvY2tzX2t2X3RhYmxlJywgb3MuZ2V0ZW52KCdTVE9DS1NfS1ZfVEFCTEUnLCAnc3RvY2tzL3N0b2Nrc19rdicpKQogICAgc2V0YXR0cihjb250ZXh0LCAnc3RvY2tzX3RzZGJfdGFibGUnLCBvcy5nZXRlbnYoJ1NUT0NLU19UU0RCX1RBQkxFJywgJ3N0b2Nrcy9zdG9ja3NfdHNkYicpKQogICAgY29udGV4dC52M2MuY3JlYXRlKGJhY2tlbmQ9J3RzZGInLCB0YWJsZT1jb250ZXh0LnN0b2Nrc190c2RiX3RhYmxlLCByYXRlPScxL20nLCBpZl9leGlzdHM9MSkKICAgIAogICAgc3RvY2tzID0gb3MuZ2V0ZW52KCdTVE9DS19MSVNUJywnR09PR0wsTVNGVCxBTVpOLEFBUEwsSU5UQycpCiAgICBpZiBzdG9ja3Muc3RhcnRzd2l0aCgnWycpOgogICAgICAgIHN0b2NrX3N5bXMgPSBhc3QubGl0ZXJhbF9ldmFsKHN0b2NrcykKICAgIGVsc2U6IAogICAgICAgIHN0b2NrX3N5bXMgPSBzdG9ja3Muc3BsaXQoJywnKQogICAgc2V0YXR0cihjb250ZXh0LCAnc3RvY2tfc3ltcycsIHN0b2NrX3N5bXMpCiAgICAKCiAgICBleHByX3RlbXBsYXRlID0gb3MuZ2V0ZW52KCdFWFBSRVNTSU9OX1RFTVBMQVRFJywgInN5bWJvbD0ne3N5bWJvbH0nO3ByaWNlPXtwcmljZX07dm9sdW1lPXt2b2x1bWV9O2xhc3RfdXBkYXRlZD0ne2xhc3RfdXBkYXRlZH0nIikKICAgIHNldGF0dHIoY29udGV4dCwgJ2V4cHJfdGVtcGxhdGUnLCBleHByX3RlbXBsYXRlKQoKICAgIGxhc3RfdHJhZGVfdGltZXMgPSB7fQogICAgc2V0YXR0cihjb250ZXh0LCAnbGFzdF90cmFkZV90aW1lcycsIGxhc3RfdHJhZGVfdGltZXMpCiAgICAKICAgIHVwZGF0ZV90aWNrZXJzKGNvbnRleHQsICc3ZCcsICcxbScpCgpkZWYgaGFuZGxlcihjb250ZXh0LCBldmVudCk6CiAgICB1cGRhdGVfdGlja2Vycyhjb250ZXh0LCAnNW0nLCAnMW0nKQogICAgcmV0dXJuICdkb25lJwoK
        noBaseImagesPull: true
      env:
      - name: V3IO_ACCESS_KEY
        value: eb6798e2-8ad3-43af-bf84-4c0e6f721f80
      - name: V3IO_USERNAME
        value: admin
      - name: V3IO_API
        value: v3io-webapi.default-tenant.svc:8081
      handler: 03-read-stocks:handler
      runtime: python:3.6
      triggers:
        secs:
          attributes:
            interval: 300s
          kind: cron
      volumes: []
  source: ''
