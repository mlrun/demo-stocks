kind: remote
metadata:
  name: read-news
  tag: ''
  hash: 23fc3e40f976f7f6dcb7fcf65ec535ff00cd4245
  project: default
spec:
  command: ''
  args: []
  image: ''
  entry_points:
    get_stock_news_page:
      name: get_stock_news_page
      doc: ''
      parameters:
      - name: stock_string
        default: ''
      outputs:
      - default: ''
      lineno: 14
    get_internal_article_links:
      name: get_internal_article_links
      doc: ''
      parameters:
      - name: page
        default: ''
      outputs:
      - default: ''
      lineno: 19
    get_article_page:
      name: get_article_page
      doc: ''
      parameters:
      - name: article_link
        default: ''
      outputs:
      - default: ''
      lineno: 24
    clean_paragraph:
      name: clean_paragraph
      doc: ''
      parameters:
      - name: paragraph
        default: ''
      outputs:
      - default: ''
      lineno: 29
    extract_text:
      name: extract_text
      doc: ''
      parameters:
      - name: article_page
        default: ''
      outputs:
      - default: ''
      lineno: 35
    get_publish_time:
      name: get_publish_time
      doc: ''
      parameters:
      - name: article_page
        default: ''
      outputs:
      - default: ''
      lineno: 41
    get_score:
      name: get_score
      doc: ''
      parameters:
      - name: paragraph_scores
        default: ''
      outputs:
      - default: ''
      lineno: 46
    get_article_scores:
      name: get_article_scores
      doc: ''
      parameters:
      - name: articles
        default: ''
      - name: endpoint
        default: ''
      outputs:
      - default: ''
      lineno: 49
    init_context:
      name: init_context
      doc: ''
      parameters:
      - name: context
        default: ''
      outputs:
      - default: ''
      lineno: 58
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: handler
        default: ''
      outputs:
      - default: ''
      lineno: 70
  description: ''
  min_replicas: 1
  max_replicas: 4
  env: []
  config:
    spec.triggers.cron:
      kind: cron
      attributes:
        interval: 300s
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from 22-09-2020 by admin
      labels: {}
      name: read-news
    spec:
      build:
        baseImage: python:3.6-jessie
        commands:
        - pip install beautifulsoup4
        - pip install pandas
        - pip install v3io_frames
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKZnJvbSBiczQgaW1wb3J0IEJlYXV0aWZ1bFNvdXAgYXMgYnMKZnJvbSB1cmxsaWIucmVxdWVzdCBpbXBvcnQgUmVxdWVzdCwgdXJsb3BlbgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgdjNpb19mcmFtZXMgYXMgdjNmCmZyb20gdW5pY29kZWRhdGEgaW1wb3J0IG5vcm1hbGl6ZQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQppbXBvcnQgcmUKaW1wb3J0IG9zCmltcG9ydCBqc29uCgpkZWYgZ2V0X3N0b2NrX25ld3NfcGFnZShzdG9ja19zdHJpbmcpOgogICAgcmVxdWVzdCA9IFJlcXVlc3QoJ2h0dHBzOi8vd3d3LmludmVzdGluZy5jb20vZXF1aXRpZXMvJyArIHN0b2NrX3N0cmluZyArICctbmV3cycsIGhlYWRlcnM9eyJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIn0pCiAgICBjb250ZW50ID0gdXJsb3BlbihyZXF1ZXN0KS5yZWFkKCkKICAgIHJldHVybiBicyhjb250ZW50LCAnaHRtbC5wYXJzZXInKQoKZGVmIGdldF9pbnRlcm5hbF9hcnRpY2xlX2xpbmtzKHBhZ2UpOgogICAgbmV3cyA9IHBhZ2UuZmluZF9hbGwoJ2RpdicsIGF0dHJzPXsnY2xhc3MnOiAnbWVkaXVtVGl0bGUxJ30pWzFdCiAgICBhcnRpY2xlcyA9IG5ld3MuZmluZF9hbGwoJ2FydGljbGUnLCBhdHRycz17J2NsYXNzJzogJ2pzLWFydGljbGUtaXRlbSBhcnRpY2xlSXRlbSd9KQogICAgcmV0dXJuIFsnaHR0cHM6Ly93d3cuaW52ZXN0aW5nLmNvbScgKyBhLmZpbmQoJ2EnKS5hdHRyc1snaHJlZiddIGZvciBhIGluIGFydGljbGVzXQoKZGVmIGdldF9hcnRpY2xlX3BhZ2UoYXJ0aWNsZV9saW5rKToKICAgIHJlcXVlc3QgPSBSZXF1ZXN0KGFydGljbGVfbGluaywgaGVhZGVycz17IlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAifSkKICAgIGNvbnRlbnQgPSB1cmxvcGVuKHJlcXVlc3QpLnJlYWQoKQogICAgcmV0dXJuIGJzKGNvbnRlbnQsICdodG1sLnBhcnNlcicpCgpkZWYgY2xlYW5fcGFyYWdyYXBoKHBhcmFncmFwaCk6CiAgICBwYXJhZ3JhcGggPSByZS5zdWIocidcKGh0dHBcUysnLCAnJywgcGFyYWdyYXBoKQogICAgcGFyYWdyYXBoID0gcmUuc3ViKHInXChbQS1aXSs6W0EtWl0rXCknLCAnJywgcGFyYWdyYXBoKQogICAgcGFyYWdyYXBoID0gcmUuc3ViKHInW1xuXHRcc1wnXScsICcgJywgcGFyYWdyYXBoKQogICAgcmV0dXJuIG5vcm1hbGl6ZSgnTkZLRCcsIHBhcmFncmFwaCkgICAgCgpkZWYgZXh0cmFjdF90ZXh0KGFydGljbGVfcGFnZSk6CiAgICB0ZXh0X3RhZyA9IGFydGljbGVfcGFnZS5maW5kKCdkaXYnLCBhdHRycz17J2NsYXNzJzogJ1dZU0lXWUcgYXJ0aWNsZVBhZ2UnfSkKICAgIHBhcmFncmFwaHMgPSB0ZXh0X3RhZy5maW5kX2FsbCgncCcpCiAgICB0ZXh0ID0gJ1xuJy5qb2luKFtjbGVhbl9wYXJhZ3JhcGgocC5nZXRfdGV4dCgpKSBmb3IgcCBpbiBwYXJhZ3JhcGhzWzotMV1dKQogICAgcmV0dXJuIHRleHQKCmRlZiBnZXRfcHVibGlzaF90aW1lKGFydGljbGVfcGFnZSk6CiAgICBkZXRhaWxzID0gYXJ0aWNsZV9wYWdlLmZpbmQoJ21ldGEnLCBhdHRycz17J2l0ZW1wcm9wJzogJ2RhdGVQdWJsaXNoZWQnfSkKICAgIHB1Ymxpc2hfZGF0ZSA9IGRldGFpbHMuZ2V0X2F0dHJpYnV0ZV9saXN0KCdjb250ZW50JylbMF0KICAgIHJldHVybiBzdHIoZGF0ZXRpbWUuc3RycHRpbWUocHVibGlzaF9kYXRlLCAnJVktJW0tJWQnKSkKCmRlZiBnZXRfc2NvcmUocGFyYWdyYXBoX3Njb3Jlcyk6CiAgICByZXR1cm4gc3VtKFtzY29yZSAtIDEgZm9yIHNjb3JlIGluIHBhcmFncmFwaF9zY29yZXNdKSAvIGxlbihwYXJhZ3JhcGhfc2NvcmVzKSAgCgpkZWYgZ2V0X2FydGljbGVfc2NvcmVzKGFydGljbGVzLCBlbmRwb2ludCk6CiAgICBzY29yZXMgPSBbXSAKICAgIGZvciBpLCBhcnRpY2xlIGluIGVudW1lcmF0ZShhcnRpY2xlcyk6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmJ2dldHRpbmcgc2NvcmUgZm9yIGFydGljbGUge2kgKyAxfVxce2xlbihhcnRpY2xlcyl9JykKICAgICAgICBldmVudF9kYXRhID0geydpbnN0YW5jZXMnOiBhcnRpY2xlLnNwbGl0KCdcbicpfQogICAgICAgIHJlc3AgPSByZXF1ZXN0cy5wdXQoZW5kcG9pbnQrJy9iZXJ0X2NsYXNzaWZpZXJfdjEvcHJlZGljdCcsIGpzb249anNvbi5kdW1wcyhldmVudF9kYXRhKSkKICAgICAgICBzY29yZXMuYXBwZW5kKGdldF9zY29yZShqc29uLmxvYWRzKHJlc3AudGV4dCkpKQogICAgcmV0dXJuIHNjb3JlcwoKZGVmIGluaXRfY29udGV4dChjb250ZXh0KToKICAgIGNsaWVudCA9IHYzZi5DbGllbnQoJ2ZyYW1lc2Q6ODA4MScsY29udGFpbmVyPW9zLmdldGVudignVjNJT19DT05UQUlORVInLCAnYmlnZGF0YScpKQogICAgc2V0YXR0cihjb250ZXh0LCAndjNjJywgY2xpZW50KQogICAgCiAgICBzZXRhdHRyKGNvbnRleHQsICdzdG9ja3Nfc3RyZWFtJywgb3MuZ2V0ZW52KCdTVE9DS1NfU1RSRUFNJywgJ3N0b2Nrcy9zdG9ja3Nfc3RyZWFtJykpCiAgICBjb250ZXh0LnYzYy5jcmVhdGUoYmFja2VuZD0nc3RyZWFtJywgdGFibGU9Y29udGV4dC5zdG9ja3Nfc3RyZWFtLCBpZl9leGlzdHM9MSkKICAgIAogICAgc2V0YXR0cihjb250ZXh0LCAnc2VudGltZW50X21vZGVsX2VuZHBvaW50Jywgb3MuZ2V0ZW52KCdTRU5USU1FTlRfTU9ERUxfRU5EUE9JTlQnLCAnaHR0cDovL251Y2xpby1zdG9ja3Mtc2VudGltZW50LWFuYWx5c2lzLXNlcnZpbmc6ODA4MCcpKQoKICAgIHN5bV90b191cmw9eydHT09HTCc6ICdnb29nbGUtaW5jJywgJ01TRlQnOiAnbWljcm9zb2Z0LWNvcnAnLCAnQU1aTic6ICdhbWF6b24tY29tLWluYycsICdBQVBMJzogJ2FwcGxlLWNvbXB1dGVyLWluYyd9CiAgICBzZXRhdHRyKGNvbnRleHQsJ3N5bV90b191cmwnLCBzeW1fdG9fdXJsKQoKZGVmIGhhbmRsZXIoY29udGV4dCwgaGFuZGxlcik6CiAgICAKICAgIHN5bXMgPSBbXQogICAgY29udGVudHMgPSBbXQogICAgbGlua3MgPSBbXQogICAgdGltZXMgPSBbXQogICAgc2VudGltZW50cyA9IFtdCiAgICAKICAgIGZvciBzeW0sIHVybF9zdHJpbmcgaW4gY29udGV4dC5zeW1fdG9fdXJsLml0ZW1zKCk6CiAgICAgICAgY29udGV4dC5sb2dnZXIuaW5mbyhmJ0dldHRpbmcgbmV3cyBhYm91dCB7c3ltfScpCiAgICAgICAgbmV3c19wYWdlID0gZ2V0X3N0b2NrX25ld3NfcGFnZSh1cmxfc3RyaW5nKQogICAgICAgIGFydGljbGVfbGlua3MgPSBnZXRfaW50ZXJuYWxfYXJ0aWNsZV9saW5rcyhuZXdzX3BhZ2UpCiAgICAgICAgYXJ0aWNsZV9wYWdlcyA9IFtnZXRfYXJ0aWNsZV9wYWdlKGxpbmspIGZvciBsaW5rIGluIGFydGljbGVfbGlua3NdCiAgICAgICAgYXJ0aWNsZXMgPSBbZXh0cmFjdF90ZXh0KGFydGljbGVfcGFnZSkgZm9yIGFydGljbGVfcGFnZSBpbiBhcnRpY2xlX3BhZ2VzXQogICAgICAgIGN1cnJfc2VudGltZW50cyA9IGdldF9hcnRpY2xlX3Njb3JlcyhhcnRpY2xlcywgY29udGV4dC5zZW50aW1lbnRfbW9kZWxfZW5kcG9pbnQpCiAgICAgICAgY3Vycl90aW1lcyA9IFtnZXRfcHVibGlzaF90aW1lKGFydGljbGVfcGFnZSkgZm9yIGFydGljbGVfcGFnZSBpbiBhcnRpY2xlX3BhZ2VzXQogICAgICAgIAogICAgICAgIHNlbnRpbWVudHMgKz0gY3Vycl9zZW50aW1lbnRzCiAgICAgICAgdGltZXMgKz0gY3Vycl90aW1lcwogICAgICAgIGZvciBhcnRpY2xlLCBsaW5rIGluIHppcChhcnRpY2xlcywgYXJ0aWNsZV9saW5rcyk6CiAgICAgICAgICAgIHN5bXMuYXBwZW5kKHN5bSkKICAgICAgICAgICAgY29udGVudHMuYXBwZW5kKGFydGljbGUpCiAgICAgICAgICAgIGxpbmtzLmFwcGVuZChsaW5rKQogICAgCiAgICAKICAgIGZvciBpIGluIHJhbmdlKGxlbihjb250ZW50cykpOgogICAgICAgIHJlY29yZCA9IHsKICAgICAgICAgICAgJ2NvbnRlbnQnOiBjb250ZW50c1tpXSwKICAgICAgICAgICAgJ3RpbWUnOiB0aW1lc1tpXSwKICAgICAgICAgICAgJ3N5bWJvbCc6IHN5bXNbaV0sCiAgICAgICAgICAgICdsaW5rJzogbGlua3NbaV0sCiAgICAgICAgICAgICdzZW50aW1lbnQnOiBzZW50aW1lbnRzW2ldCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGNvbnRleHQudjNjLmV4ZWN1dGUoJ3N0cmVhbScsIGNvbnRleHQuc3RvY2tzX3N0cmVhbSwgJ3B1dCcsIGFyZ3M9eydkYXRhJzoganNvbi5kdW1wcyhyZWNvcmQpfSkKCg==
        noBaseImagesPull: true
      env:
      - name: V3IO_ACCESS_KEY
        value: eb6798e2-8ad3-43af-bf84-4c0e6f721f80
      - name: V3IO_USERNAME
        value: admin
      - name: V3IO_API
        value: v3io-webapi.default-tenant.svc:8081
      handler: 04-read-news:handler
      runtime: python:3.6
      volumes: []
  source: ''
