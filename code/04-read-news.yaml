kind: remote
metadata:
  name: read-news
  tag: ''
  hash: 6cc7095cb3ad6bf6c5e508ef4ce808f8350a1ab5
  project: default
spec:
  command: ''
  args: []
  image: ''
  entry_points:
    get_stock_news_page:
      name: get_stock_news_page
      doc: ''
      parameters:
      - name: stock_string
        default: ''
      outputs:
      - default: ''
      lineno: 14
    get_internal_article_links:
      name: get_internal_article_links
      doc: ''
      parameters:
      - name: page
        default: ''
      outputs:
      - default: ''
      lineno: 19
    get_article_page:
      name: get_article_page
      doc: ''
      parameters:
      - name: article_link
        default: ''
      outputs:
      - default: ''
      lineno: 24
    clean_paragraph:
      name: clean_paragraph
      doc: ''
      parameters:
      - name: paragraph
        default: ''
      outputs:
      - default: ''
      lineno: 29
    extract_text:
      name: extract_text
      doc: ''
      parameters:
      - name: article_page
        default: ''
      outputs:
      - default: ''
      lineno: 35
    get_publish_time:
      name: get_publish_time
      doc: ''
      parameters:
      - name: article_page
        default: ''
      outputs:
      - default: ''
      lineno: 41
    get_score:
      name: get_score
      doc: ''
      parameters:
      - name: paragraph_scores
        default: ''
      outputs:
      - default: ''
      lineno: 46
    get_article_scores:
      name: get_article_scores
      doc: ''
      parameters:
      - name: articles
        default: ''
      - name: endpoint
        default: ''
      outputs:
      - default: ''
      lineno: 49
    init_context:
      name: init_context
      doc: ''
      parameters:
      - name: context
        default: ''
      outputs:
      - default: ''
      lineno: 58
    handler:
      name: handler
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: handler
        default: ''
      outputs:
      - default: ''
      lineno: 73
  description: ''
  min_replicas: 1
  max_replicas: 4
  env: []
  config:
    spec.triggers.cron:
      kind: cron
      attributes:
        interval: 300s
  base_spec:
    apiVersion: nuclio.io/v1
    kind: Function
    metadata:
      annotations:
        nuclio.io/generated_by: function generated from 23-09-2020 by admin
      labels: {}
      name: read-news
    spec:
      build:
        baseImage: python:3.6-jessie
        commands:
        - pip install beautifulsoup4
        - pip install pandas
        - pip install v3io_frames
        functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKZnJvbSBiczQgaW1wb3J0IEJlYXV0aWZ1bFNvdXAgYXMgYnMKZnJvbSB1cmxsaWIucmVxdWVzdCBpbXBvcnQgUmVxdWVzdCwgdXJsb3BlbgppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgdjNpb19mcmFtZXMgYXMgdjNmCmZyb20gdW5pY29kZWRhdGEgaW1wb3J0IG5vcm1hbGl6ZQpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZQppbXBvcnQgcmUKaW1wb3J0IG9zCmltcG9ydCBqc29uCgpkZWYgZ2V0X3N0b2NrX25ld3NfcGFnZShzdG9ja19zdHJpbmcpOgogICAgcmVxdWVzdCA9IFJlcXVlc3QoJ2h0dHBzOi8vd3d3LmludmVzdGluZy5jb20vZXF1aXRpZXMvJyArIHN0b2NrX3N0cmluZyArICctbmV3cycsIGhlYWRlcnM9eyJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIn0pCiAgICBjb250ZW50ID0gdXJsb3BlbihyZXF1ZXN0KS5yZWFkKCkKICAgIHJldHVybiBicyhjb250ZW50LCAnaHRtbC5wYXJzZXInKQoKZGVmIGdldF9pbnRlcm5hbF9hcnRpY2xlX2xpbmtzKHBhZ2UpOgogICAgbmV3cyA9IHBhZ2UuZmluZF9hbGwoJ2RpdicsIGF0dHJzPXsnY2xhc3MnOiAnbWVkaXVtVGl0bGUxJ30pWzFdCiAgICBhcnRpY2xlcyA9IG5ld3MuZmluZF9hbGwoJ2FydGljbGUnLCBhdHRycz17J2NsYXNzJzogJ2pzLWFydGljbGUtaXRlbSBhcnRpY2xlSXRlbSd9KQogICAgcmV0dXJuIFsnaHR0cHM6Ly93d3cuaW52ZXN0aW5nLmNvbScgKyBhLmZpbmQoJ2EnKS5hdHRyc1snaHJlZiddIGZvciBhIGluIGFydGljbGVzXQoKZGVmIGdldF9hcnRpY2xlX3BhZ2UoYXJ0aWNsZV9saW5rKToKICAgIHJlcXVlc3QgPSBSZXF1ZXN0KGFydGljbGVfbGluaywgaGVhZGVycz17IlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAifSkKICAgIGNvbnRlbnQgPSB1cmxvcGVuKHJlcXVlc3QpLnJlYWQoKQogICAgcmV0dXJuIGJzKGNvbnRlbnQsICdodG1sLnBhcnNlcicpCgpkZWYgY2xlYW5fcGFyYWdyYXBoKHBhcmFncmFwaCk6CiAgICBwYXJhZ3JhcGggPSByZS5zdWIocidcKGh0dHBcUysnLCAnJywgcGFyYWdyYXBoKQogICAgcGFyYWdyYXBoID0gcmUuc3ViKHInXChbQS1aXSs6W0EtWl0rXCknLCAnJywgcGFyYWdyYXBoKQogICAgcGFyYWdyYXBoID0gcmUuc3ViKHInW1xuXHRcc1wnXScsICcgJywgcGFyYWdyYXBoKQogICAgcmV0dXJuIG5vcm1hbGl6ZSgnTkZLRCcsIHBhcmFncmFwaCkgICAgCgpkZWYgZXh0cmFjdF90ZXh0KGFydGljbGVfcGFnZSk6CiAgICB0ZXh0X3RhZyA9IGFydGljbGVfcGFnZS5maW5kKCdkaXYnLCBhdHRycz17J2NsYXNzJzogJ1dZU0lXWUcgYXJ0aWNsZVBhZ2UnfSkKICAgIHBhcmFncmFwaHMgPSB0ZXh0X3RhZy5maW5kX2FsbCgncCcpCiAgICB0ZXh0ID0gJ1xuJy5qb2luKFtjbGVhbl9wYXJhZ3JhcGgocC5nZXRfdGV4dCgpKSBmb3IgcCBpbiBwYXJhZ3JhcGhzWzotMV1dKQogICAgcmV0dXJuIHRleHQKCmRlZiBnZXRfcHVibGlzaF90aW1lKGFydGljbGVfcGFnZSk6CiAgICBkZXRhaWxzID0gYXJ0aWNsZV9wYWdlLmZpbmQoJ21ldGEnLCBhdHRycz17J2l0ZW1wcm9wJzogJ2RhdGVNb2RpZmllZCd9KQogICAgcHVibGlzaF9kYXRlID0gZGV0YWlscy5nZXRfYXR0cmlidXRlX2xpc3QoJ2NvbnRlbnQnKVswXQogICAgcmV0dXJuIHN0cihkYXRldGltZS5zdHJwdGltZShwdWJsaXNoX2RhdGUsICclWS0lbS0lZCAlSDolTTolUycpKQoKZGVmIGdldF9zY29yZShwYXJhZ3JhcGhfc2NvcmVzKToKICAgIHJldHVybiBzdW0oW3Njb3JlIC0gMSBmb3Igc2NvcmUgaW4gcGFyYWdyYXBoX3Njb3Jlc10pIC8gbGVuKHBhcmFncmFwaF9zY29yZXMpICAKCmRlZiBnZXRfYXJ0aWNsZV9zY29yZXMoYXJ0aWNsZXMsIGVuZHBvaW50KToKICAgIHNjb3JlcyA9IFtdIAogICAgZm9yIGksIGFydGljbGUgaW4gZW51bWVyYXRlKGFydGljbGVzKToKICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYnZ2V0dGluZyBzY29yZSBmb3IgYXJ0aWNsZSB7aSArIDF9XFx7bGVuKGFydGljbGVzKX0nKQogICAgICAgIGV2ZW50X2RhdGEgPSB7J2luc3RhbmNlcyc6IGFydGljbGUuc3BsaXQoJ1xuJyl9CiAgICAgICAgcmVzcCA9IHJlcXVlc3RzLnB1dChlbmRwb2ludCsnL2JlcnRfY2xhc3NpZmllcl92MS9wcmVkaWN0JywganNvbj1qc29uLmR1bXBzKGV2ZW50X2RhdGEpKQogICAgICAgIHNjb3Jlcy5hcHBlbmQoZ2V0X3Njb3JlKGpzb24ubG9hZHMocmVzcC50ZXh0KSkpCiAgICByZXR1cm4gc2NvcmVzCgpkZWYgaW5pdF9jb250ZXh0KGNvbnRleHQpOgogICAgY2xpZW50ID0gdjNmLkNsaWVudCgnZnJhbWVzZDo4MDgxJyxjb250YWluZXI9b3MuZ2V0ZW52KCdWM0lPX0NPTlRBSU5FUicsICdiaWdkYXRhJykpCiAgICBzZXRhdHRyKGNvbnRleHQsICd2M2MnLCBjbGllbnQpCiAgICAKICAgIHNldGF0dHIoY29udGV4dCwgJ3N0b2Nrc19zdHJlYW0nLCBvcy5nZXRlbnYoJ1NUT0NLU19TVFJFQU0nLCAnc3RvY2tzL3N0b2Nrc19zdHJlYW0nKSkKICAgIGNvbnRleHQudjNjLmNyZWF0ZShiYWNrZW5kPSdzdHJlYW0nLCB0YWJsZT1jb250ZXh0LnN0b2Nrc19zdHJlYW0sIGlmX2V4aXN0cz0xKQogICAgCiAgICBzZXRhdHRyKGNvbnRleHQsICdzdG9ja3NfdHNkYicsIG9zLmdldGVudignU1RPQ0tTX1NFTlRJTUVOVF9UU0RCX1RBQkxFJywgJ3N0b2Nrcy9zdG9ja3Nfc2VudGltZW50X3RzZGInKSkKICAgIGNvbnRleHQudjNjLmNyZWF0ZShiYWNrZW5kPSd0c2RiJywgdGFibGU9Y29udGV4dC5zdG9ja3NfdHNkYiwgcmF0ZT0nMS9zJywgaWZfZXhpc3RzPTEpCiAgICAKICAgIHNldGF0dHIoY29udGV4dCwgJ3NlbnRpbWVudF9tb2RlbF9lbmRwb2ludCcsIG9zLmdldGVudignU0VOVElNRU5UX01PREVMX0VORFBPSU5UJywgJ2h0dHA6Ly9udWNsaW8tc3RvY2tzLXNlbnRpbWVudC1hbmFseXNpcy1zZXJ2aW5nOjgwODAnKSkKCiAgICBzeW1fdG9fdXJsPXsnR09PR0wnOiAnZ29vZ2xlLWluYycsICdNU0ZUJzogJ21pY3Jvc29mdC1jb3JwJywgJ0FNWk4nOiAnYW1hem9uLWNvbS1pbmMnLCAnQUFQTCc6ICdhcHBsZS1jb21wdXRlci1pbmMnfQogICAgc2V0YXR0cihjb250ZXh0LCdzeW1fdG9fdXJsJywgc3ltX3RvX3VybCkKCmRlZiBoYW5kbGVyKGNvbnRleHQsIGhhbmRsZXIpOgogICAgCiAgICBzeW1zID0gW10KICAgIGNvbnRlbnRzID0gW10KICAgIGxpbmtzID0gW10KICAgIHRpbWVzID0gW10KICAgIHNlbnRpbWVudHMgPSBbXQogICAgCiAgICBmb3Igc3ltLCB1cmxfc3RyaW5nIGluIGNvbnRleHQuc3ltX3RvX3VybC5pdGVtcygpOgogICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZidHZXR0aW5nIG5ld3MgYWJvdXQge3N5bX0nKQogICAgICAgIG5ld3NfcGFnZSA9IGdldF9zdG9ja19uZXdzX3BhZ2UodXJsX3N0cmluZykKICAgICAgICBhcnRpY2xlX2xpbmtzID0gZ2V0X2ludGVybmFsX2FydGljbGVfbGlua3MobmV3c19wYWdlKQogICAgICAgIGFydGljbGVfcGFnZXMgPSBbZ2V0X2FydGljbGVfcGFnZShsaW5rKSBmb3IgbGluayBpbiBhcnRpY2xlX2xpbmtzXQogICAgICAgIGFydGljbGVzID0gW2V4dHJhY3RfdGV4dChhcnRpY2xlX3BhZ2UpIGZvciBhcnRpY2xlX3BhZ2UgaW4gYXJ0aWNsZV9wYWdlc10KICAgICAgICBjdXJyX3NlbnRpbWVudHMgPSBnZXRfYXJ0aWNsZV9zY29yZXMoYXJ0aWNsZXMsIGNvbnRleHQuc2VudGltZW50X21vZGVsX2VuZHBvaW50KQogICAgICAgIGN1cnJfdGltZXMgPSBbZ2V0X3B1Ymxpc2hfdGltZShhcnRpY2xlX3BhZ2UpIGZvciBhcnRpY2xlX3BhZ2UgaW4gYXJ0aWNsZV9wYWdlc10KICAgICAgICAKICAgICAgICBzZW50aW1lbnRzICs9IGN1cnJfc2VudGltZW50cwogICAgICAgIHRpbWVzICs9IGN1cnJfdGltZXMKICAgICAgICBmb3IgYXJ0aWNsZSwgbGluaywgc2VudGltZW50LCB0aW1lIGluIHppcChhcnRpY2xlcywgYXJ0aWNsZV9saW5rcywgY3Vycl9zZW50aW1lbnRzLCBjdXJyX3RpbWVzKToKICAgICAgICAgICAgcmVjb3JkID0gewogICAgICAgICAgICAgICAgJ2NvbnRlbnQnOiBhcnRpY2xlLAogICAgICAgICAgICAgICAgJ3RpbWUnOiB0aW1lLAogICAgICAgICAgICAgICAgJ3N5bWJvbCc6IHN5bSwKICAgICAgICAgICAgICAgICdsaW5rJzogbGluaywKICAgICAgICAgICAgICAgICdzZW50aW1lbnQnOiBzZW50aW1lbnQKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250ZXh0LnYzYy5leGVjdXRlKCdzdHJlYW0nLCBjb250ZXh0LnN0b2Nrc19zdHJlYW0sICdwdXQnLCBhcmdzPXsnZGF0YSc6IGpzb24uZHVtcHMocmVjb3JkKX0pCiAgICAgICAgICAgIAogICAgICAgICAgICBzeW1zLmFwcGVuZChzeW0pCiAgICAgICAgICAgIGNvbnRlbnRzLmFwcGVuZChhcnRpY2xlKQogICAgICAgICAgICBsaW5rcy5hcHBlbmQobGluaykKICAgICAgICAgICAgICAgICAgCiAgICBpZiBsZW4oc2VudGltZW50cyk+MDoKICAgICAgICBkZiA9IHBkLkRhdGFGcmFtZS5mcm9tX2RpY3QoeydzZW50aW1lbnQnOiBzZW50aW1lbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbWUnOiB0aW1lcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzeW1ib2wnOiBzeW1zfSkKICAgICAgICBkZiA9IGRmLnNldF9pbmRleChbJ3RpbWUnLCAnc3ltYm9sJ10pCiAgICAgICAgZGYuaW5kZXggPSBkZi5pbmRleC5zZXRfbGV2ZWxzKFtwZC50b19kYXRldGltZShkZi5pbmRleC5sZXZlbHNbMF0pLCBkZi5pbmRleC5sZXZlbHNbMV1dKQogICAgICAgIGRmID0gZGYuc29ydF9pbmRleChsZXZlbD0wLCBheGlzPTApCiAgICAgICAgY29udGV4dC5sb2dnZXIuZGVidWdfd2l0aCgnd3JpdGluZyBkYXRhIHRvIFRTREInLCBkZj1kZikKICAgICAgICBjb250ZXh0LnYzYy53cml0ZShiYWNrZW5kPSd0c2RiJywgdGFibGU9Y29udGV4dC5zdG9ja3NfdHNkYiwgZGZzPWRmKQoK
        noBaseImagesPull: true
      env:
      - name: V3IO_ACCESS_KEY
        value: eb6798e2-8ad3-43af-bf84-4c0e6f721f80
      - name: V3IO_USERNAME
        value: admin
      - name: V3IO_API
        value: v3io-webapi.default-tenant.svc:8081
      handler: 04-read-news:handler
      runtime: python:3.6
      volumes: []
  source: ''
